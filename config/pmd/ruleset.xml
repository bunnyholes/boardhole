<?xml version="1.0"?>
<ruleset name="board-hole-pmd-rules"
         xmlns="http://pmd.sourceforge.net/ruleset/2.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://pmd.sourceforge.net/ruleset/2.0.0 https://pmd.sourceforge.io/ruleset_2_0_0.xsd">

    <description>엄격한 PMD 룰셋 for Board Hole 프로젝트 - 업계 표준 품질 기준</description>

    <!-- Best Practices - 엄격한 모범 사례 적용 -->
    <rule ref="category/java/bestpractices.xml"/>

    <!-- Code Style - 엄격한 코드 스타일 -->
    <rule ref="category/java/codestyle.xml">
        <!-- Spring/Lombok과 충돌하는 규칙만 제외 -->
        <exclude name="AtLeastOneConstructor"/>  <!-- Lombok @NoArgsConstructor -->
        <exclude name="CommentDefaultAccessModifier"/>  <!-- package-private는 의도적 -->
    </rule>

    <!-- Design - 엄격한 설계 원칙 -->
    <rule ref="category/java/design.xml">
        <!-- 엔터프라이즈 환경에서 불가피한 규칙만 제외 -->
        <exclude name="LoosePackageCoupling"/>  <!-- 도메인 간 결합은 불가피 -->
    </rule>

    <!-- Documentation - 문서화 강제 -->
    <rule ref="category/java/documentation.xml"/>

    <!-- Error Prone - 오류 가능성 제거 -->
    <rule ref="category/java/errorprone.xml"/>

    <!-- Multithreading - 동시성 안전성 -->
    <rule ref="category/java/multithreading.xml"/>

    <!-- Performance - 성능 최적화 -->
    <rule ref="category/java/performance.xml"/>

    <!-- Security - 보안 강화 -->
    <rule ref="category/java/security.xml"/>

    <!-- ===== Lombok 사용 완전 강제 규칙 (모든 기존 코드 포함) ===== -->
    <!-- 우선순위 1: 빌드 실패, 우선순위 2: 경고 -->
    
    <!-- 수동 getter/setter 메서드 완전 금지 -->
    <rule name="UseLombokForAccessors"
          language="java"
          class="net.sourceforge.pmd.lang.rule.XPathRule"
          message="수동 getter/setter 대신 Lombok @Getter/@Setter를 사용하세요">
        <description>
            [LOMBOK 강제] 모든 단순 getter/setter는 반드시 Lombok을 사용해야 합니다.
            비즈니스 로직이 포함된 메서드만 허용됩니다.
        </description>
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
//MethodDeclaration[
    (starts-with(@Name, 'get') or starts-with(@Name, 'set'))
    and not(../Annotation//Name[@Image='Override'])
    and (../../../TypeDeclaration[@Kind='CLASS'])
    and not(../Annotation//Name[@Image='Getter' or @Image='Setter' or @Image='Data'])
]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- 빈 생성자 금지 -->
    <rule name="UseLombokForNoArgsConstructor"
          language="java"
          class="net.sourceforge.pmd.lang.rule.XPathRule"
          message="빈 생성자 대신 Lombok @NoArgsConstructor를 사용하세요">
        <description>
            빈 생성자는 Lombok @NoArgsConstructor로 대체되어야 합니다.
        </description>
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
//ConstructorDeclaration[
    count(FormalParameters/FormalParameter) = 0
    and count(BlockStatement) = 0
    and not(../Annotation//Name[@Image='NoArgsConstructor' or @Image='Data'])
]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- toString() 수동 구현 금지 -->
    <rule name="UseLombokForToString"
          language="java"
          class="net.sourceforge.pmd.lang.rule.XPathRule"
          message="수동 toString() 대신 Lombok @ToString을 사용하세요">
        <description>
            toString() 메서드는 Lombok @ToString으로 대체되어야 합니다.
        </description>
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
//MethodDeclaration[
    @Name='toString'
    and ResultType//Type[@TypeImage='String']
    and count(FormalParameters/FormalParameter) = 0
    and not(../Annotation//Name[@Image='ToString' or @Image='Data'])
]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- equals/hashCode 수동 구현 금지 -->
    <rule name="UseLombokForEqualsAndHashCode"
          language="java"
          class="net.sourceforge.pmd.lang.rule.XPathRule"
          message="수동 equals/hashCode 대신 Lombok @EqualsAndHashCode를 사용하세요">
        <description>
            equals와 hashCode 메서드는 Lombok @EqualsAndHashCode로 대체되어야 합니다.
        </description>
        <priority>1</priority>
        <properties>
            <property name="xpath">
                <value><![CDATA[
//MethodDeclaration[
    (@Name='equals' or @Name='hashCode')
    and not(../Annotation//Name[@Image='EqualsAndHashCode' or @Image='Data'])
]
                ]]></value>
            </property>
        </properties>
    </rule>

    <!-- 엄격한 복잡도 제한 -->
    <rule ref="category/java/design.xml/CyclomaticComplexity">
        <properties>
            <property name="methodReportLevel" value="7"/>   <!-- 업계 표준: 7 이하 -->
            <property name="classReportLevel" value="25"/>   <!-- 업계 표준: 25 이하 -->
        </properties>
    </rule>

    <!-- 인지 복잡도 제한 -->
    <rule ref="category/java/design.xml/CognitiveComplexity">
        <properties>
            <property name="reportLevel" value="10"/>  <!-- 업계 표준: 10 이하 -->
        </properties>
    </rule>

    <!-- 메서드 개수 제한 -->
    <rule ref="category/java/design.xml/TooManyMethods">
        <properties>
            <property name="maxmethods" value="15"/>  <!-- 업계 표준: 15개 이하 -->
        </properties>
    </rule>

    <!-- 필드 개수 제한 -->
    <rule ref="category/java/design.xml/TooManyFields">
        <properties>
            <property name="maxfields" value="10"/>  <!-- 업계 표준: 10개 이하 -->
        </properties>
    </rule>

    <!-- 매개변수 개수 제한 -->
    <rule ref="category/java/design.xml/ExcessiveParameterList">
        <properties>
            <property name="minimum" value="5"/>  <!-- 업계 표준: 5개 이하 -->
        </properties>
    </rule>

    <!-- 메서드 길이 제한 -->
    <rule ref="category/java/design.xml/NPathComplexity">
        <properties>
            <property name="reportLevel" value="200"/>
        </properties>
    </rule>

    <!-- 클래스 길이 제한 -->
    <rule ref="category/java/design.xml/ExcessivePublicCount">
        <properties>
            <property name="minimum" value="20"/>
        </properties>
    </rule>

    <!-- 컨트롤러에서 ResponseEntity 사용 금지 -->
    <rule name="NoResponseEntityInController"
          message="컨트롤러에서 ResponseEntity를 직접 반환하지 마세요. @ResponseStatus나 ResponseBodyAdvice를 사용하세요."
          language="java"
          class="net.sourceforge.pmd.lang.rule.xpath.XPathRule">
        <properties>
            <property name="xpath" value="//ClassDeclaration[.//Annotation[@SimpleName='Controller' or @SimpleName='RestController']]//MethodDeclaration//Type//ClassType[@SimpleName='ResponseEntity']"/>
        </properties>
        <priority>1</priority>
    </rule>

</ruleset>